@{
    ViewData["Title"] = "patio";
}
<head>
    <link rel="stylesheet" href="~/css/style.css" />
</head>
<body class="patio">
@{if(!ViewBag.estaDesbloqueada){ 
<div id="zona-drop">
    
</div>
<div class="contenedor-dialogo" id="contenedorPatio">
    <p id="textoDialogo">Haz clic para comenzar</p>
</div>
<img src="/img/viktor.png" id= "viktor">
<div id="zonaorigen">
<img src="/img/luna.png" id="luna" draggable="true" class="arbusto">
<img src="/img/cruz.png" id="cruz" draggable="true" class="arbusto">
<img src="/img/estrella.png" id="estrella" draggable="true" class="arbusto">
<img src="/img/diamante.png" id="diamante" draggable="true" class="arbusto">
<img src="/img/triangulo.png" id="triangulo" draggable="true" class="arbusto">
</div>

<form id="claveForm" method="post" action='@Url.Action("desbloquearSala")'>
    <input type="hidden" name="clave" value="desbloquear" />
    <input type="hidden" name="sala" value=2 />
    <input type="hidden" name="salaOriginal" value="patio" />
</form>
<a href="#" id="pergamino"><img src="/img/pergamino.png" alt="elemento"> </a>
<div id="modalPergamino" style="display:none;">
    <div id="modalContenido">
        <span id="cerrarModal">&times;</span>
        <p> Primero, el destello brillante que perfora el velo del crepúsculo.<br>
        Después, una plateada curva silenciosa que vela los sueños.<br>
Luego, el cazador poderoso, joya del cielo nocturno, íntegro en su forma.<br>
Sigue la vela austral, que guía navíos perdidos.<br>
Y al final, la cruz solemne donde los caminos se unen.<br>
...solo en su verdadero orden, lo oculto se revelará.
</p>
    </div>
</div>
<script>
    const dialogos = [
        "Buenos días, joven @ViewBag.nombre. No suelo ver mucha gente por el jardín... no desde que el señor partió. La quietud, al menos, parecía inalterable.",
        "Mis ojos están acostumbrados a la quietud de la tierra, a la paciente espera de las estaciones. Pero estos arbustos... sus formas celestiales han sido trastocadas. Solían seguir una disposición… mas hoy, su armonía se ha roto.", "Alguien ha estado aquí durante la noche...",
      "Espero que no busques algo que no debas encontrar."]

    let dialogoId = 0;
    let terminoDialogo = false;

    document.getElementById("contenedorPatio").addEventListener("click", function () {
        if (dialogoId < dialogos.length) {
            document.getElementById("textoDialogo").textContent = dialogos[dialogoId];
            dialogoId++;
        } else {
            terminoDialogo = true;
            document.getElementById("contenedorPatio").style.display = "none";
        }
    });

    const zonaDrop = document.getElementById("zona-drop");
    const ordenActual = [];

    document.querySelectorAll(".arbusto").forEach(el => {
        el.addEventListener("dragstart", (e) => {
            e.dataTransfer.setData("text/plain", e.target.id);
        });
    });

    zonaDrop.addEventListener("dragover", (e) => {
        e.preventDefault();
        zonaDrop.style.backgroundColor = "#eef";
    });

    zonaDrop.addEventListener("dragleave", (e) => {
        zonaDrop.style.backgroundColor = "";
    });

    zonaDrop.addEventListener("drop", (e) => {
        e.preventDefault();
        zonaDrop.style.backgroundColor = "";
        const id = e.dataTransfer.getData("text/plain");
      if (!ordenActual.includes(id)) {
            const img = document.getElementById(id).cloneNode(true);
            img.style.width = "50px";
            img.draggable = false;

 
            img.addEventListener("click", () => {
                zonaDrop.removeChild(img);
                const index = ordenActual.indexOf(id);
                if (index !== -1) ordenActual.splice(index, 1);
            });
             zonaDrop.appendChild(img);
            ordenActual.push(id);
      }

        const ordenCorrecto = ["estrella", "diamante", "luna", "triangulo", "cruz"];
        if (ordenActual.length === ordenCorrecto.length &&
            ordenActual.every((val, idx) => val === ordenCorrecto[idx])) {
            document.getElementById("claveForm").submit();
            document.getElementById("zonaorigen").style.display = "none";
        }
    });

// Abrir modal al hacer clic en el pergamino
document.getElementById("pergamino").addEventListener("click", function(e) {
    e.preventDefault(); // evita que el enlace recargue la página
    document.getElementById("modalPergamino").style.display = "block";
});

// Cerrar modal al hacer clic en la X
document.getElementById("cerrarModal").addEventListener("click", function() {
    document.getElementById("modalPergamino").style.display = "none";
});

// Cerrar modal si haces clic fuera del contenido
window.addEventListener("click", function(e) {
    if (e.target === document.getElementById("modalPergamino")) {
        document.getElementById("modalPergamino").style.display = "none";
    }
});
</script>
}else{
    <h5>Al acomodr los arbustos escuchas un misterioso ruido proveniente desde detras de una de las plantas. Al acercarte notas que hay una nota pegada discrtamente ahi</h5>
    <img src="/img/pista1.png" alt=pista1>
    /* <form method="post" action='@Url.Action("agregarPista")'></form> */

  }
}
</body>