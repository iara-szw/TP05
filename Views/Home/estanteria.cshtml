@{ ViewData["Title"] = "estanteria"; }
    <link rel="stylesheet" href="~/css/style.css" />

    <body class="estanteria">
    <header>
        <a href="@Url.Action("salaDeEstar")">Volver a la sala de estar</a>
    </header>
@if (!ViewBag.estaDesbloqueada)
{
    <h2>Ordená los frascos haciendo clic en dos para intercambiarlos</h2>

    <form id="ordenForm" method="post" action="@Url.Action("desbloquearSala")">
        <ul id="estanteria" class="estanteria">
            <li value="N"><img src="/img/frasco1.png" alt="Miel Negra" class="frasco"></li>
            <li value="K"><img src="/img/frasco2.png" alt="Té Keemun" class="frasco"></li>
            <li value="J"><img src="/img/frasco3.png" alt="Jengibre" class="frasco"></li>
            <li value="M"><img src="/img/frasco4.png" alt="Menta" class="frasco"></li>
            <li value="C"><img src="/img/frasco5.png" alt="Canela" class="frasco"></li>
        </ul>
        
        <input type="hidden" name="clave" id='ordenFrascos' />
        <input type="hidden" name="sala" value="3" />
        <input type="hidden" name="salaOriginal" value="estanteria" />
        <button type="submit">Confirmar orden</button>
    </form>
}
else
{
    <h2 class="contenedorDialogo">“HMF AU ATNRUREE” (Olga te esta esperando en la cocina)</h2>

}

<script>
    const estanteria = document.getElementById('estanteria');
    let seleccionado = null;

    estanteria.querySelectorAll('li').forEach(item => {
        item.style.cursor = 'pointer';
       item.addEventListener('click', () => {
        if (!seleccionado) {
            // Primer clic: selecciona el frasco
            seleccionado = item;
            seleccionado.style.transform = 'scale(1.1)'; // agranda sutilmente
        } else if (seleccionado === item) {
            // Clic en el mismo: deselecciona
            seleccionado.style.transform = ''; // vuelve a tamaño normal
            seleccionado = null;
        } else {
            // Segundo clic: intercambiar posiciones
            seleccionado.style.transform = ''; // vuelve a tamaño normal

            // Intercambiar nodos li dentro de ul
            const nodo1 = seleccionado;
            const nodo2 = item;

            // Guardar referencia de nodo siguiente
            const nodo1Sig = nodo1.nextSibling;
            const nodo2Sig = nodo2.nextSibling;

            // Intercambiar: insertamos nodo1 antes de nodo2Sig, y nodo2 antes de nodo1Sig
            estanteria.insertBefore(nodo1, nodo2Sig);
            estanteria.insertBefore(nodo2, nodo1Sig);

                       seleccionado = null;
            }
        });
    });

    document.getElementById('ordenForm').addEventListener('submit', function (e) {
        const items = estanteria.querySelectorAll('li');
        const orden = Array.from(items).map(item => item.getAttribute('value'));
        document.querySelector('input[name="clave"]').value = orden.join('');
    });
</script>
</body>